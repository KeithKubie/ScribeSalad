WEBVTT
Kind: captions
Language: en

00:00:04.670 --> 00:00:06.980
hi I'm Chet Haase an engineer on the

00:00:06.980 --> 00:00:06.990
hi I'm Chet Haase an engineer on the
 

00:00:06.990 --> 00:00:10.280
hi I'm Chet Haase an engineer on the
Android team at Google I do a bunch of

00:00:10.280 --> 00:00:10.290
Android team at Google I do a bunch of
 

00:00:10.290 --> 00:00:12.499
Android team at Google I do a bunch of
work on animations and I've done some

00:00:12.499 --> 00:00:12.509
work on animations and I've done some
 

00:00:12.509 --> 00:00:14.089
work on animations and I've done some
dead bytes in the past on ListView

00:00:14.089 --> 00:00:14.099
dead bytes in the past on ListView
 

00:00:14.099 --> 00:00:16.580
dead bytes in the past on ListView
animations and I got a request to show

00:00:16.580 --> 00:00:16.590
animations and I got a request to show
 

00:00:16.590 --> 00:00:18.410
animations and I got a request to show
how you might animate adding and

00:00:18.410 --> 00:00:18.420
how you might animate adding and
 

00:00:18.420 --> 00:00:20.540
how you might animate adding and
removing items from the ListView so

00:00:20.540 --> 00:00:20.550
removing items from the ListView so
 

00:00:20.550 --> 00:00:22.759
removing items from the ListView so
recently I did a talk with Tom Agee on

00:00:22.759 --> 00:00:22.769
recently I did a talk with Tom Agee on
 

00:00:22.769 --> 00:00:25.340
recently I did a talk with Tom Agee on
animations at Google i/o you might want

00:00:25.340 --> 00:00:25.350
animations at Google i/o you might want
 

00:00:25.350 --> 00:00:26.630
animations at Google i/o you might want
to check that out since it has some of

00:00:26.630 --> 00:00:26.640
to check that out since it has some of
 

00:00:26.640 --> 00:00:29.080
to check that out since it has some of
the content and related content as well

00:00:29.080 --> 00:00:29.090
the content and related content as well
 

00:00:29.090 --> 00:00:32.319
the content and related content as well
and one of the demos that I showed was

00:00:32.319 --> 00:00:32.329
and one of the demos that I showed was
 

00:00:32.329 --> 00:00:34.970
and one of the demos that I showed was
removing items from the ListView exactly

00:00:34.970 --> 00:00:34.980
removing items from the ListView exactly
 

00:00:34.980 --> 00:00:36.709
removing items from the ListView exactly
what people wanted I've tuned the code a

00:00:36.709 --> 00:00:36.719
what people wanted I've tuned the code a
 

00:00:36.719 --> 00:00:37.970
what people wanted I've tuned the code a
little bit to make it a little more

00:00:37.970 --> 00:00:37.980
little bit to make it a little more
 

00:00:37.980 --> 00:00:40.520
little bit to make it a little more
general purpose and we're going to show

00:00:40.520 --> 00:00:40.530
general purpose and we're going to show
 

00:00:40.530 --> 00:00:43.010
general purpose and we're going to show
a bit more about how it actually works

00:00:43.010 --> 00:00:43.020
a bit more about how it actually works
 

00:00:43.020 --> 00:00:46.340
a bit more about how it actually works
today so the idea with ListView removals

00:00:46.340 --> 00:00:46.350
today so the idea with ListView removals
 

00:00:46.350 --> 00:00:47.959
today so the idea with ListView removals
is that you're deleting an item there

00:00:47.959 --> 00:00:47.969
is that you're deleting an item there
 

00:00:47.969 --> 00:00:49.610
is that you're deleting an item there
maybe you want to swipe it out and the

00:00:49.610 --> 00:00:49.620
maybe you want to swipe it out and the
 

00:00:49.620 --> 00:00:51.200
maybe you want to swipe it out and the
demo that I have you swipe these items

00:00:51.200 --> 00:00:51.210
demo that I have you swipe these items
 

00:00:51.210 --> 00:00:53.240
demo that I have you swipe these items
out and then the swipe itself is

00:00:53.240 --> 00:00:53.250
out and then the swipe itself is
 

00:00:53.250 --> 00:00:54.950
out and then the swipe itself is
animated and after the item is removed

00:00:54.950 --> 00:00:54.960
animated and after the item is removed
 

00:00:54.960 --> 00:00:57.350
animated and after the item is removed
from the ListView the ListView collapses

00:00:57.350 --> 00:00:57.360
from the ListView the ListView collapses
 

00:00:57.360 --> 00:01:00.229
from the ListView the ListView collapses
the gap around that item and views move

00:01:00.229 --> 00:01:00.239
the gap around that item and views move
 

00:01:00.239 --> 00:01:02.029
the gap around that item and views move
in from the top or the bottom wherever

00:01:02.029 --> 00:01:02.039
in from the top or the bottom wherever
 

00:01:02.039 --> 00:01:04.100
in from the top or the bottom wherever
they need to and all of this is seamless

00:01:04.100 --> 00:01:04.110
they need to and all of this is seamless
 

00:01:04.110 --> 00:01:06.590
they need to and all of this is seamless
to the user it's kind of the effect and

00:01:06.590 --> 00:01:06.600
to the user it's kind of the effect and
 

00:01:06.600 --> 00:01:08.030
to the user it's kind of the effect and
the feel that you want with the ListView

00:01:08.030 --> 00:01:08.040
the feel that you want with the ListView
 

00:01:08.040 --> 00:01:10.160
the feel that you want with the ListView
but it may not be particularly obvious

00:01:10.160 --> 00:01:10.170
but it may not be particularly obvious
 

00:01:10.170 --> 00:01:13.100
but it may not be particularly obvious
how to do so so let's see how this

00:01:13.100 --> 00:01:13.110
how to do so so let's see how this
 

00:01:13.110 --> 00:01:15.310
how to do so so let's see how this
actually works today now one important

00:01:15.310 --> 00:01:15.320
actually works today now one important
 

00:01:15.320 --> 00:01:17.300
actually works today now one important
point that I should point out if you

00:01:17.300 --> 00:01:17.310
point that I should point out if you
 

00:01:17.310 --> 00:01:19.370
point that I should point out if you
look closely at the code in the Google

00:01:19.370 --> 00:01:19.380
look closely at the code in the Google
 

00:01:19.380 --> 00:01:21.350
look closely at the code in the Google
i/o version of this demo you'll see this

00:01:21.350 --> 00:01:21.360
i/o version of this demo you'll see this
 

00:01:21.360 --> 00:01:23.749
i/o version of this demo you'll see this
I was using a property called transient

00:01:23.749 --> 00:01:23.759
I was using a property called transient
 

00:01:23.759 --> 00:01:25.219
I was using a property called transient
state which was added in jellybean I've

00:01:25.219 --> 00:01:25.229
state which was added in jellybean I've
 

00:01:25.229 --> 00:01:27.830
state which was added in jellybean I've
actually removed that it's it's used

00:01:27.830 --> 00:01:27.840
actually removed that it's it's used
 

00:01:27.840 --> 00:01:29.510
actually removed that it's it's used
implicitly under the hood when you use a

00:01:29.510 --> 00:01:29.520
implicitly under the hood when you use a
 

00:01:29.520 --> 00:01:31.100
implicitly under the hood when you use a
view property animator but I'm not using

00:01:31.100 --> 00:01:31.110
view property animator but I'm not using
 

00:01:31.110 --> 00:01:32.870
view property animator but I'm not using
it explicitly in the demo code anymore

00:01:32.870 --> 00:01:32.880
it explicitly in the demo code anymore
 

00:01:32.880 --> 00:01:34.640
it explicitly in the demo code anymore
because I actually found a more general

00:01:34.640 --> 00:01:34.650
because I actually found a more general
 

00:01:34.650 --> 00:01:36.770
because I actually found a more general
purpose way of doing this animation so

00:01:36.770 --> 00:01:36.780
purpose way of doing this animation so
 

00:01:36.780 --> 00:01:38.030
purpose way of doing this animation so
it's a little more applicable to

00:01:38.030 --> 00:01:38.040
it's a little more applicable to
 

00:01:38.040 --> 00:01:40.550
it's a little more applicable to
different releases as well so let's see

00:01:40.550 --> 00:01:40.560
different releases as well so let's see
 

00:01:40.560 --> 00:01:42.289
different releases as well so let's see
how it works so if we take a look at the

00:01:42.289 --> 00:01:42.299
how it works so if we take a look at the
 

00:01:42.299 --> 00:01:45.139
how it works so if we take a look at the
code one important point and this is

00:01:45.139 --> 00:01:45.149
code one important point and this is
 

00:01:45.149 --> 00:01:47.420
code one important point and this is
right at the heart of why I don't need a

00:01:47.420 --> 00:01:47.430
right at the heart of why I don't need a
 

00:01:47.430 --> 00:01:48.889
right at the heart of why I don't need a
transient state anymore is that I'm

00:01:48.889 --> 00:01:48.899
transient state anymore is that I'm
 

00:01:48.899 --> 00:01:51.230
transient state anymore is that I'm
using a stable array adapter this is a

00:01:51.230 --> 00:01:51.240
using a stable array adapter this is a
 

00:01:51.240 --> 00:01:53.270
using a stable array adapter this is a
subclass of array adapter that I created

00:01:53.270 --> 00:01:53.280
subclass of array adapter that I created
 

00:01:53.280 --> 00:01:56.420
subclass of array adapter that I created
to return true for has stable IDs this

00:01:56.420 --> 00:01:56.430
to return true for has stable IDs this
 

00:01:56.430 --> 00:01:58.940
to return true for has stable IDs this
is a key element because I'm no longer

00:01:58.940 --> 00:01:58.950
is a key element because I'm no longer
 

00:01:58.950 --> 00:02:01.219
is a key element because I'm no longer
animating the views directly getting

00:02:01.219 --> 00:02:01.229
animating the views directly getting
 

00:02:01.229 --> 00:02:02.990
animating the views directly getting
information directly from the views and

00:02:02.990 --> 00:02:03.000
information directly from the views and
 

00:02:03.000 --> 00:02:05.120
information directly from the views and
then making sure that those views all

00:02:05.120 --> 00:02:05.130
then making sure that those views all
 

00:02:05.130 --> 00:02:06.410
then making sure that those views all
stay on the screen at the same time

00:02:06.410 --> 00:02:06.420
stay on the screen at the same time
 

00:02:06.420 --> 00:02:08.089
stay on the screen at the same time
that's dependent upon the jellybeans

00:02:08.089 --> 00:02:08.099
that's dependent upon the jellybeans
 

00:02:08.099 --> 00:02:10.190
that's dependent upon the jellybeans
capability of transient State instead I

00:02:10.190 --> 00:02:10.200
capability of transient State instead I
 

00:02:10.200 --> 00:02:13.059
capability of transient State instead I
am dependent upon the underlying array

00:02:13.059 --> 00:02:13.069
am dependent upon the underlying array
 

00:02:13.069 --> 00:02:16.479
am dependent upon the underlying array
adapter to have stable ID so that I can

00:02:16.479 --> 00:02:16.489
adapter to have stable ID so that I can
 

00:02:16.489 --> 00:02:18.729
adapter to have stable ID so that I can
count on those items actually being in

00:02:18.729 --> 00:02:18.739
count on those items actually being in
 

00:02:18.739 --> 00:02:21.039
count on those items actually being in
the same as changes in the array adapter

00:02:21.039 --> 00:02:21.049
the same as changes in the array adapter
 

00:02:21.049 --> 00:02:23.949
the same as changes in the array adapter
happen so I do that by returning true

00:02:23.949 --> 00:02:23.959
happen so I do that by returning true
 

00:02:23.959 --> 00:02:27.099
happen so I do that by returning true
there and when I get item ID I actually

00:02:27.099 --> 00:02:27.109
there and when I get item ID I actually
 

00:02:27.109 --> 00:02:29.470
there and when I get item ID I actually
get unique IDs as I process the array

00:02:29.470 --> 00:02:29.480
get unique IDs as I process the array
 

00:02:29.480 --> 00:02:32.080
get unique IDs as I process the array
and then one the only other custom thing

00:02:32.080 --> 00:02:32.090
and then one the only other custom thing
 

00:02:32.090 --> 00:02:33.789
and then one the only other custom thing
that happens in this array adapter is I

00:02:33.789 --> 00:02:33.799
that happens in this array adapter is I
 

00:02:33.799 --> 00:02:36.039
that happens in this array adapter is I
set a non touch listener because every

00:02:36.039 --> 00:02:36.049
set a non touch listener because every
 

00:02:36.049 --> 00:02:38.619
set a non touch listener because every
item in the view as its created I want

00:02:38.619 --> 00:02:38.629
item in the view as its created I want
 

00:02:38.629 --> 00:02:41.409
item in the view as its created I want
it to know where to go for its touch

00:02:41.409 --> 00:02:41.419
it to know where to go for its touch
 

00:02:41.419 --> 00:02:42.640
it to know where to go for its touch
events because I'm going to customize

00:02:42.640 --> 00:02:42.650
events because I'm going to customize
 

00:02:42.650 --> 00:02:44.949
events because I'm going to customize
that with some swiping behavior which

00:02:44.949 --> 00:02:44.959
that with some swiping behavior which
 

00:02:44.959 --> 00:02:48.190
that with some swiping behavior which
we'll see very soon so if we go back to

00:02:48.190 --> 00:02:48.200
we'll see very soon so if we go back to
 

00:02:48.200 --> 00:02:50.229
we'll see very soon so if we go back to
our activity class

00:02:50.229 --> 00:02:50.239
our activity class
 

00:02:50.239 --> 00:02:52.360
our activity class
here's that touch listener that we were

00:02:52.360 --> 00:02:52.370
here's that touch listener that we were
 

00:02:52.370 --> 00:02:55.000
here's that touch listener that we were
just talking about so the idea here is

00:02:55.000 --> 00:02:55.010
just talking about so the idea here is
 

00:02:55.010 --> 00:02:58.240
just talking about so the idea here is
that I want to note when the user clicks

00:02:58.240 --> 00:02:58.250
that I want to note when the user clicks
 

00:02:58.250 --> 00:03:00.189
that I want to note when the user clicks
down and I want to note when they sweat

00:03:00.189 --> 00:03:00.199
down and I want to note when they sweat
 

00:03:00.199 --> 00:03:02.439
down and I want to note when they sweat
left to right because I I want to first

00:03:02.439 --> 00:03:02.449
left to right because I I want to first
 

00:03:02.449 --> 00:03:04.000
left to right because I I want to first
detect when it's gone far enough that

00:03:04.000 --> 00:03:04.010
detect when it's gone far enough that
 

00:03:04.010 --> 00:03:06.069
detect when it's gone far enough that
we're actually in a swiping motion now

00:03:06.069 --> 00:03:06.079
we're actually in a swiping motion now
 

00:03:06.079 --> 00:03:08.259
we're actually in a swiping motion now
so I'm going to start animating that as

00:03:08.259 --> 00:03:08.269
so I'm going to start animating that as
 

00:03:08.269 --> 00:03:10.059
so I'm going to start animating that as
they move their finger so then I want to

00:03:10.059 --> 00:03:10.069
they move their finger so then I want to
 

00:03:10.069 --> 00:03:11.740
they move their finger so then I want to
position the view and I want to also set

00:03:11.740 --> 00:03:11.750
position the view and I want to also set
 

00:03:11.750 --> 00:03:13.839
position the view and I want to also set
the Alpha the view to make it disappear

00:03:13.839 --> 00:03:13.849
the Alpha the view to make it disappear
 

00:03:13.849 --> 00:03:15.399
the Alpha the view to make it disappear
more the closer to the edge of the

00:03:15.399 --> 00:03:15.409
more the closer to the edge of the
 

00:03:15.409 --> 00:03:17.890
more the closer to the edge of the
screen that it gets and then when they

00:03:17.890 --> 00:03:17.900
screen that it gets and then when they
 

00:03:17.900 --> 00:03:19.509
screen that it gets and then when they
actually let go with that item I want to

00:03:19.509 --> 00:03:19.519
actually let go with that item I want to
 

00:03:19.519 --> 00:03:21.159
actually let go with that item I want to
determine whether to snap the item back

00:03:21.159 --> 00:03:21.169
determine whether to snap the item back
 

00:03:21.169 --> 00:03:23.140
determine whether to snap the item back
or to animate it all the way off I

00:03:23.140 --> 00:03:23.150
or to animate it all the way off I
 

00:03:23.150 --> 00:03:26.649
or to animate it all the way off I
should point out that in the widgets

00:03:26.649 --> 00:03:26.659
should point out that in the widgets
 

00:03:26.659 --> 00:03:28.059
should point out that in the widgets
that we actually ship we use velocity

00:03:28.059 --> 00:03:28.069
that we actually ship we use velocity
 

00:03:28.069 --> 00:03:29.589
that we actually ship we use velocity
tracking which is a better way to do

00:03:29.589 --> 00:03:29.599
tracking which is a better way to do
 

00:03:29.599 --> 00:03:30.909
tracking which is a better way to do
this in general I'm using a simple

00:03:30.909 --> 00:03:30.919
this in general I'm using a simple
 

00:03:30.919 --> 00:03:33.039
this in general I'm using a simple
heuristic of how far have you moved

00:03:33.039 --> 00:03:33.049
heuristic of how far have you moved
 

00:03:33.049 --> 00:03:35.140
heuristic of how far have you moved
instead which works for the purposes the

00:03:35.140 --> 00:03:35.150
instead which works for the purposes the
 

00:03:35.150 --> 00:03:37.960
instead which works for the purposes the
demo I think a more full version of this

00:03:37.960 --> 00:03:37.970
demo I think a more full version of this
 

00:03:37.970 --> 00:03:39.550
demo I think a more full version of this
effect would actually use velocity

00:03:39.550 --> 00:03:39.560
effect would actually use velocity
 

00:03:39.560 --> 00:03:41.710
effect would actually use velocity
tracking instead so that as you lift it

00:03:41.710 --> 00:03:41.720
tracking instead so that as you lift it
 

00:03:41.720 --> 00:03:43.809
tracking instead so that as you lift it
off your finger as your sweat is swiping

00:03:43.809 --> 00:03:43.819
off your finger as your sweat is swiping
 

00:03:43.819 --> 00:03:45.399
off your finger as your sweat is swiping
to the right then the item would

00:03:45.399 --> 00:03:45.409
to the right then the item would
 

00:03:45.409 --> 00:03:47.170
to the right then the item would
actually animate at the same speed that

00:03:47.170 --> 00:03:47.180
actually animate at the same speed that
 

00:03:47.180 --> 00:03:49.599
actually animate at the same speed that
it was just moving which is a nicer

00:03:49.599 --> 00:03:49.609
it was just moving which is a nicer
 

00:03:49.609 --> 00:03:51.759
it was just moving which is a nicer
effect nevertheless a simple approach

00:03:51.759 --> 00:03:51.769
effect nevertheless a simple approach
 

00:03:51.769 --> 00:03:54.189
effect nevertheless a simple approach
here and also simple to change using

00:03:54.189 --> 00:03:54.199
here and also simple to change using
 

00:03:54.199 --> 00:03:56.409
here and also simple to change using
velocity instead so when the user

00:03:56.409 --> 00:03:56.419
velocity instead so when the user
 

00:03:56.419 --> 00:03:58.809
velocity instead so when the user
presses down if there's another item

00:03:58.809 --> 00:03:58.819
presses down if there's another item
 

00:03:58.819 --> 00:04:00.550
presses down if there's another item
pressing I'm not handling multi-touch

00:04:00.550 --> 00:04:00.560
pressing I'm not handling multi-touch
 

00:04:00.560 --> 00:04:02.979
pressing I'm not handling multi-touch
clicks here we're just making a simple

00:04:02.979 --> 00:04:02.989
clicks here we're just making a simple
 

00:04:02.989 --> 00:04:04.839
clicks here we're just making a simple
demo here so we return false we're not

00:04:04.839 --> 00:04:04.849
demo here so we return false we're not
 

00:04:04.849 --> 00:04:07.059
demo here so we return false we're not
going to handle this event otherwise we

00:04:07.059 --> 00:04:07.069
going to handle this event otherwise we
 

00:04:07.069 --> 00:04:09.009
going to handle this event otherwise we
set the value say okay we're now

00:04:09.009 --> 00:04:09.019
set the value say okay we're now
 

00:04:09.019 --> 00:04:10.990
set the value say okay we're now
tracking things and we're going to note

00:04:10.990 --> 00:04:11.000
tracking things and we're going to note
 

00:04:11.000 --> 00:04:13.089
tracking things and we're going to note
the initial version of the initial

00:04:13.089 --> 00:04:13.099
the initial version of the initial
 

00:04:13.099 --> 00:04:15.249
the initial version of the initial
location that they press down in so that

00:04:15.249 --> 00:04:15.259
location that they press down in so that
 

00:04:15.259 --> 00:04:17.830
location that they press down in so that
we know how far to move the item in

00:04:17.830 --> 00:04:17.840
we know how far to move the item in
 

00:04:17.840 --> 00:04:20.069
we know how far to move the item in
initial move events when there is a

00:04:20.069 --> 00:04:20.079
initial move events when there is a
 

00:04:20.079 --> 00:04:22.659
initial move events when there is a
subsequent move event here we get the

00:04:22.659 --> 00:04:22.669
subsequent move event here we get the
 

00:04:22.669 --> 00:04:24.730
subsequent move event here we get the
current location of that

00:04:24.730 --> 00:04:24.740
current location of that
 

00:04:24.740 --> 00:04:26.860
current location of that
and then we know how far the user has

00:04:26.860 --> 00:04:26.870
and then we know how far the user has
 

00:04:26.870 --> 00:04:30.580
and then we know how far the user has
moved the item in general and then we

00:04:30.580 --> 00:04:30.590
moved the item in general and then we
 

00:04:30.590 --> 00:04:32.740
moved the item in general and then we
also know whether to detect for swipe

00:04:32.740 --> 00:04:32.750
also know whether to detect for swipe
 

00:04:32.750 --> 00:04:35.290
also know whether to detect for swipe
slop which is basically how far they

00:04:35.290 --> 00:04:35.300
slop which is basically how far they
 

00:04:35.300 --> 00:04:36.969
slop which is basically how far they
moved head they moved past the point

00:04:36.969 --> 00:04:36.979
moved head they moved past the point
 

00:04:36.979 --> 00:04:38.950
moved head they moved past the point
where yes we we think it's not just an

00:04:38.950 --> 00:04:38.960
where yes we we think it's not just an
 

00:04:38.960 --> 00:04:40.120
where yes we we think it's not just an
error but we should actually start

00:04:40.120 --> 00:04:40.130
error but we should actually start
 

00:04:40.130 --> 00:04:41.770
error but we should actually start
swiping this thing out so you see a

00:04:41.770 --> 00:04:41.780
swiping this thing out so you see a
 

00:04:41.780 --> 00:04:43.150
swiping this thing out so you see a
little jump at the beginning as we

00:04:43.150 --> 00:04:43.160
little jump at the beginning as we
 

00:04:43.160 --> 00:04:45.279
little jump at the beginning as we
detect that is not just noise but

00:04:45.279 --> 00:04:45.289
detect that is not just noise but
 

00:04:45.289 --> 00:04:47.409
detect that is not just noise but
they're actually moving it far enough

00:04:47.409 --> 00:04:47.419
they're actually moving it far enough
 

00:04:47.419 --> 00:04:50.080
they're actually moving it far enough
for us to start swiping it away we tell

00:04:50.080 --> 00:04:50.090
for us to start swiping it away we tell
 

00:04:50.090 --> 00:04:52.180
for us to start swiping it away we tell
the ListView to disallow intercept touch

00:04:52.180 --> 00:04:52.190
the ListView to disallow intercept touch
 

00:04:52.190 --> 00:04:53.589
the ListView to disallow intercept touch
events because I don't want the ListView

00:04:53.589 --> 00:04:53.599
events because I don't want the ListView
 

00:04:53.599 --> 00:04:55.240
events because I don't want the ListView
doing its own thing with scrolling up

00:04:55.240 --> 00:04:55.250
doing its own thing with scrolling up
 

00:04:55.250 --> 00:04:56.680
doing its own thing with scrolling up
and down at the same time as I'm trying

00:04:56.680 --> 00:04:56.690
and down at the same time as I'm trying
 

00:04:56.690 --> 00:04:59.080
and down at the same time as I'm trying
to swipe items back and forth so when

00:04:59.080 --> 00:04:59.090
to swipe items back and forth so when
 

00:04:59.090 --> 00:05:00.430
to swipe items back and forth so when
you call this method and set it to true

00:05:00.430 --> 00:05:00.440
you call this method and set it to true
 

00:05:00.440 --> 00:05:04.150
you call this method and set it to true
then until the final up event from the

00:05:04.150 --> 00:05:04.160
then until the final up event from the
 

00:05:04.160 --> 00:05:07.029
then until the final up event from the
touch event processor then the items

00:05:07.029 --> 00:05:07.039
touch event processor then the items
 

00:05:07.039 --> 00:05:08.650
touch event processor then the items
have full control over here the ListView

00:05:08.650 --> 00:05:08.660
have full control over here the ListView
 

00:05:08.660 --> 00:05:09.520
have full control over here the ListView
will not get in your way

00:05:09.520 --> 00:05:09.530
will not get in your way
 

00:05:09.530 --> 00:05:11.230
will not get in your way
and then we tell the background

00:05:11.230 --> 00:05:11.240
and then we tell the background
 

00:05:11.240 --> 00:05:12.820
and then we tell the background
container to show the background we'll

00:05:12.820 --> 00:05:12.830
container to show the background we'll
 

00:05:12.830 --> 00:05:14.140
container to show the background we'll
get into this a little bit later this is

00:05:14.140 --> 00:05:14.150
get into this a little bit later this is
 

00:05:14.150 --> 00:05:15.969
get into this a little bit later this is
the detail about what exactly go we're

00:05:15.969 --> 00:05:15.979
the detail about what exactly go we're
 

00:05:15.979 --> 00:05:18.070
the detail about what exactly go we're
going to show behind the item as its

00:05:18.070 --> 00:05:18.080
going to show behind the item as its
 

00:05:18.080 --> 00:05:21.730
going to show behind the item as its
swiped away so if we're actually swiping

00:05:21.730 --> 00:05:21.740
swiped away so if we're actually swiping
 

00:05:21.740 --> 00:05:23.620
swiped away so if we're actually swiping
this thing then we're going to set the

00:05:23.620 --> 00:05:23.630
this thing then we're going to set the
 

00:05:23.630 --> 00:05:25.120
this thing then we're going to set the
translation X so we're going to move

00:05:25.120 --> 00:05:25.130
translation X so we're going to move
 

00:05:25.130 --> 00:05:26.980
translation X so we're going to move
this item back and forth according to

00:05:26.980 --> 00:05:26.990
this item back and forth according to
 

00:05:26.990 --> 00:05:29.830
this item back and forth according to
how far the users finger has moved and

00:05:29.830 --> 00:05:29.840
how far the users finger has moved and
 

00:05:29.840 --> 00:05:30.909
how far the users finger has moved and
we're going to set the Alpha we

00:05:30.909 --> 00:05:30.919
we're going to set the Alpha we
 

00:05:30.919 --> 00:05:32.950
we're going to set the Alpha we
basically want it to be the inverse of

00:05:32.950 --> 00:05:32.960
basically want it to be the inverse of
 

00:05:32.960 --> 00:05:36.520
basically want it to be the inverse of
how far away it is from wherever they

00:05:36.520 --> 00:05:36.530
how far away it is from wherever they
 

00:05:36.530 --> 00:05:37.990
how far away it is from wherever they
started so the closer they get to the

00:05:37.990 --> 00:05:38.000
started so the closer they get to the
 

00:05:38.000 --> 00:05:39.490
started so the closer they get to the
edge of the screen one way or the other

00:05:39.490 --> 00:05:39.500
edge of the screen one way or the other
 

00:05:39.500 --> 00:05:41.620
edge of the screen one way or the other
the more translucent it's going to be

00:05:41.620 --> 00:05:41.630
the more translucent it's going to be
 

00:05:41.630 --> 00:05:43.240
the more translucent it's going to be
the idea being that it's going to fade

00:05:43.240 --> 00:05:43.250
the idea being that it's going to fade
 

00:05:43.250 --> 00:05:44.920
the idea being that it's going to fade
out all the way by the time it gets off

00:05:44.920 --> 00:05:44.930
out all the way by the time it gets off
 

00:05:44.930 --> 00:05:47.020
out all the way by the time it gets off
the screen and then finally when the

00:05:47.020 --> 00:05:47.030
the screen and then finally when the
 

00:05:47.030 --> 00:05:49.600
the screen and then finally when the
user lifts up if they were swiping this

00:05:49.600 --> 00:05:49.610
user lifts up if they were swiping this
 

00:05:49.610 --> 00:05:51.820
user lifts up if they were swiping this
thing then we can find out how far they

00:05:51.820 --> 00:05:51.830
thing then we can find out how far they
 

00:05:51.830 --> 00:05:54.310
thing then we can find out how far they
swipe it whether they're going off the

00:05:54.310 --> 00:05:54.320
swipe it whether they're going off the
 

00:05:54.320 --> 00:05:56.050
swipe it whether they're going off the
screen to the left off the screen to the

00:05:56.050 --> 00:05:56.060
screen to the left off the screen to the
 

00:05:56.060 --> 00:06:00.010
screen to the left off the screen to the
right and then we can set the duration

00:06:00.010 --> 00:06:00.020
right and then we can set the duration
 

00:06:00.020 --> 00:06:01.899
right and then we can set the duration
based on that we're going to set the

00:06:01.899 --> 00:06:01.909
based on that we're going to set the
 

00:06:01.909 --> 00:06:03.879
based on that we're going to set the
duration based on how far they had left

00:06:03.879 --> 00:06:03.889
duration based on how far they had left
 

00:06:03.889 --> 00:06:06.040
duration based on how far they had left
to go to the edge of the screen whether

00:06:06.040 --> 00:06:06.050
to go to the edge of the screen whether
 

00:06:06.050 --> 00:06:07.450
to go to the edge of the screen whether
they're whether it's popping back into

00:06:07.450 --> 00:06:07.460
they're whether it's popping back into
 

00:06:07.460 --> 00:06:09.339
they're whether it's popping back into
place or actually popping all the way

00:06:09.339 --> 00:06:09.349
place or actually popping all the way
 

00:06:09.349 --> 00:06:12.219
place or actually popping all the way
off the screen we're going to set

00:06:12.219 --> 00:06:12.229
off the screen we're going to set
 

00:06:12.229 --> 00:06:14.770
off the screen we're going to set
enabled false on the ListView this

00:06:14.770 --> 00:06:14.780
enabled false on the ListView this
 

00:06:14.780 --> 00:06:16.540
enabled false on the ListView this
prevents the user from doing something

00:06:16.540 --> 00:06:16.550
prevents the user from doing something
 

00:06:16.550 --> 00:06:18.100
prevents the user from doing something
silly like actually scrolling and

00:06:18.100 --> 00:06:18.110
silly like actually scrolling and
 

00:06:18.110 --> 00:06:20.110
silly like actually scrolling and
flinging the ListView at the same time

00:06:20.110 --> 00:06:20.120
flinging the ListView at the same time
 

00:06:20.120 --> 00:06:21.610
flinging the ListView at the same time
as we're animating all the views into

00:06:21.610 --> 00:06:21.620
as we're animating all the views into
 

00:06:21.620 --> 00:06:23.680
as we're animating all the views into
place makes things look a little bit

00:06:23.680 --> 00:06:23.690
place makes things look a little bit
 

00:06:23.690 --> 00:06:25.209
place makes things look a little bit
more consistent and reasonable on the

00:06:25.209 --> 00:06:25.219
more consistent and reasonable on the
 

00:06:25.219 --> 00:06:26.649
more consistent and reasonable on the
screen and then we're going to set that

00:06:26.649 --> 00:06:26.659
screen and then we're going to set that
 

00:06:26.659 --> 00:06:28.600
screen and then we're going to set that
enabled to true when we're actually all

00:06:28.600 --> 00:06:28.610
enabled to true when we're actually all
 

00:06:28.610 --> 00:06:30.249
enabled to true when we're actually all
done with the animation there's two

00:06:30.249 --> 00:06:30.259
done with the animation there's two
 

00:06:30.259 --> 00:06:31.600
done with the animation there's two
animations that are going to kick in

00:06:31.600 --> 00:06:31.610
animations that are going to kick in
 

00:06:31.610 --> 00:06:32.950
animations that are going to kick in
here the first is that we're going to

00:06:32.950 --> 00:06:32.960
here the first is that we're going to
 

00:06:32.960 --> 00:06:34.930
here the first is that we're going to
animate the swipe out or the swipe back

00:06:34.930 --> 00:06:34.940
animate the swipe out or the swipe back
 

00:06:34.940 --> 00:06:36.850
animate the swipe out or the swipe back
and then if it was a swipe out then

00:06:36.850 --> 00:06:36.860
and then if it was a swipe out then
 

00:06:36.860 --> 00:06:38.530
and then if it was a swipe out then
we're going to run a following animation

00:06:38.530 --> 00:06:38.540
we're going to run a following animation
 

00:06:38.540 --> 00:06:40.330
we're going to run a following animation
which is going to animate the closure of

00:06:40.330 --> 00:06:40.340
which is going to animate the closure of
 

00:06:40.340 --> 00:06:42.340
which is going to animate the closure of
the gap that that item created when it

00:06:42.340 --> 00:06:42.350
the gap that that item created when it
 

00:06:42.350 --> 00:06:44.590
the gap that that item created when it
was removed from the list so we're going

00:06:44.590 --> 00:06:44.600
was removed from the list so we're going
 

00:06:44.600 --> 00:06:46.930
was removed from the list so we're going
to set the duration according that that

00:06:46.930 --> 00:06:46.940
to set the duration according that that
 

00:06:46.940 --> 00:06:49.300
to set the duration according that that
duration that we calculated before we're

00:06:49.300 --> 00:06:49.310
duration that we calculated before we're
 

00:06:49.310 --> 00:06:51.760
duration that we calculated before we're
going to animate alpha this is using a

00:06:51.760 --> 00:06:51.770
going to animate alpha this is using a
 

00:06:51.770 --> 00:06:54.640
going to animate alpha this is using a
view property animator which was API

00:06:54.640 --> 00:06:54.650
view property animator which was API
 

00:06:54.650 --> 00:06:59.250
view property animator which was API
that came in in 3.1 honeycomb 3.1 and

00:06:59.250 --> 00:06:59.260
that came in in 3.1 honeycomb 3.1 and
 

00:06:59.260 --> 00:07:01.630
that came in in 3.1 honeycomb 3.1 and
we're also going to animate translation

00:07:01.630 --> 00:07:01.640
we're also going to animate translation
 

00:07:01.640 --> 00:07:03.670
we're also going to animate translation
X to its end value either back all the

00:07:03.670 --> 00:07:03.680
X to its end value either back all the
 

00:07:03.680 --> 00:07:05.290
X to its end value either back all the
way on the screen or all the way off the

00:07:05.290 --> 00:07:05.300
way on the screen or all the way off the
 

00:07:05.300 --> 00:07:07.120
way on the screen or all the way off the
screen and then we're going to run oh

00:07:07.120 --> 00:07:07.130
screen and then we're going to run oh
 

00:07:07.130 --> 00:07:09.670
screen and then we're going to run oh
and action now this is API that came in

00:07:09.670 --> 00:07:09.680
and action now this is API that came in
 

00:07:09.680 --> 00:07:11.020
and action now this is API that came in
in jellybean so if you're writing for

00:07:11.020 --> 00:07:11.030
in jellybean so if you're writing for
 

00:07:11.030 --> 00:07:12.520
in jellybean so if you're writing for
jellybean and later that's fine if

00:07:12.520 --> 00:07:12.530
jellybean and later that's fine if
 

00:07:12.530 --> 00:07:16.300
jellybean and later that's fine if
you're writing for API for runtimes that

00:07:16.300 --> 00:07:16.310
you're writing for API for runtimes that
 

00:07:16.310 --> 00:07:18.610
you're writing for API for runtimes that
are earlier than jellybean you don't

00:07:18.610 --> 00:07:18.620
are earlier than jellybean you don't
 

00:07:18.620 --> 00:07:20.320
are earlier than jellybean you don't
have to use an end action here instead

00:07:20.320 --> 00:07:20.330
have to use an end action here instead
 

00:07:20.330 --> 00:07:22.930
have to use an end action here instead
you can set up a listener on the view

00:07:22.930 --> 00:07:22.940
you can set up a listener on the view
 

00:07:22.940 --> 00:07:24.820
you can set up a listener on the view
property animator and it's just a little

00:07:24.820 --> 00:07:24.830
property animator and it's just a little
 

00:07:24.830 --> 00:07:26.170
property animator and it's just a little
bit more code but it's effectively the

00:07:26.170 --> 00:07:26.180
bit more code but it's effectively the
 

00:07:26.180 --> 00:07:27.300
bit more code but it's effectively the
same thing

00:07:27.300 --> 00:07:27.310
same thing
 

00:07:27.310 --> 00:07:29.650
same thing
when the end of the animation happens

00:07:29.650 --> 00:07:29.660
when the end of the animation happens
 

00:07:29.660 --> 00:07:30.880
when the end of the animation happens
we're going to run this code so the

00:07:30.880 --> 00:07:30.890
we're going to run this code so the
 

00:07:30.890 --> 00:07:32.500
we're going to run this code so the
swipe has happened now we actually want

00:07:32.500 --> 00:07:32.510
swipe has happened now we actually want
 

00:07:32.510 --> 00:07:35.980
swipe has happened now we actually want
to animate the removal animate moving

00:07:35.980 --> 00:07:35.990
to animate the removal animate moving
 

00:07:35.990 --> 00:07:38.740
to animate the removal animate moving
the removing the gap in the ListView so

00:07:38.740 --> 00:07:38.750
the removing the gap in the ListView so
 

00:07:38.750 --> 00:07:40.540
the removing the gap in the ListView so
if we're actually removing the item if

00:07:40.540 --> 00:07:40.550
if we're actually removing the item if
 

00:07:40.550 --> 00:07:42.160
if we're actually removing the item if
it was swiped off then we're going to

00:07:42.160 --> 00:07:42.170
it was swiped off then we're going to
 

00:07:42.170 --> 00:07:44.800
it was swiped off then we're going to
animate removal here otherwise we're all

00:07:44.800 --> 00:07:44.810
animate removal here otherwise we're all
 

00:07:44.810 --> 00:07:46.060
animate removal here otherwise we're all
done and we're just going to restore the

00:07:46.060 --> 00:07:46.070
done and we're just going to restore the
 

00:07:46.070 --> 00:07:48.760
done and we're just going to restore the
values that we need so animate removal

00:07:48.760 --> 00:07:48.770
values that we need so animate removal
 

00:07:48.770 --> 00:07:50.830
values that we need so animate removal
is down here now this is the different

00:07:50.830 --> 00:07:50.840
is down here now this is the different
 

00:07:50.840 --> 00:07:52.360
is down here now this is the different
approach from the one that we took at

00:07:52.360 --> 00:07:52.370
approach from the one that we took at
 

00:07:52.370 --> 00:07:55.270
approach from the one that we took at
Google i/o the the talk in Google i/o

00:07:55.270 --> 00:07:55.280
Google i/o the the talk in Google i/o
 

00:07:55.280 --> 00:07:57.370
Google i/o the the talk in Google i/o
talked about let's track where the views

00:07:57.370 --> 00:07:57.380
talked about let's track where the views
 

00:07:57.380 --> 00:07:59.050
talked about let's track where the views
are here and let's set transient State

00:07:59.050 --> 00:07:59.060
are here and let's set transient State
 

00:07:59.060 --> 00:08:00.340
are here and let's set transient State
on all those views to make sure that

00:08:00.340 --> 00:08:00.350
on all those views to make sure that
 

00:08:00.350 --> 00:08:01.870
on all those views to make sure that
they don't get recycled when layout

00:08:01.870 --> 00:08:01.880
they don't get recycled when layout
 

00:08:01.880 --> 00:08:04.090
they don't get recycled when layout
occurs we don't care about that anymore

00:08:04.090 --> 00:08:04.100
occurs we don't care about that anymore
 

00:08:04.100 --> 00:08:06.490
occurs we don't care about that anymore
because we're using item IDs instead so

00:08:06.490 --> 00:08:06.500
because we're using item IDs instead so
 

00:08:06.500 --> 00:08:08.470
because we're using item IDs instead so
what's happening is the following for

00:08:08.470 --> 00:08:08.480
what's happening is the following for
 

00:08:08.480 --> 00:08:10.150
what's happening is the following for
all children that are currently in the

00:08:10.150 --> 00:08:10.160
all children that are currently in the
 

00:08:10.160 --> 00:08:11.920
all children that are currently in the
ListView and this is before layout runs

00:08:11.920 --> 00:08:11.930
ListView and this is before layout runs
 

00:08:11.930 --> 00:08:14.350
ListView and this is before layout runs
so there's no data set change yet the

00:08:14.350 --> 00:08:14.360
so there's no data set change yet the
 

00:08:14.360 --> 00:08:16.450
so there's no data set change yet the
list is just the way that it was at the

00:08:16.450 --> 00:08:16.460
list is just the way that it was at the
 

00:08:16.460 --> 00:08:18.430
list is just the way that it was at the
time that the user was swiping it we're

00:08:18.430 --> 00:08:18.440
time that the user was swiping it we're
 

00:08:18.440 --> 00:08:20.310
time that the user was swiping it we're
going to track where these things are

00:08:20.310 --> 00:08:20.320
going to track where these things are
 

00:08:20.320 --> 00:08:23.200
going to track where these things are
but so we want to know where the views

00:08:23.200 --> 00:08:23.210
but so we want to know where the views
 

00:08:23.210 --> 00:08:24.340
but so we want to know where the views
are but we're going to store that

00:08:24.340 --> 00:08:24.350
are but we're going to store that
 

00:08:24.350 --> 00:08:28.120
are but we're going to store that
information about position in a hash map

00:08:28.120 --> 00:08:28.130
information about position in a hash map
 

00:08:28.130 --> 00:08:30.400
information about position in a hash map
that's keyed off of the item ID instead

00:08:30.400 --> 00:08:30.410
that's keyed off of the item ID instead
 

00:08:30.410 --> 00:08:33.250
that's keyed off of the item ID instead
of the view itself right so for every

00:08:33.250 --> 00:08:33.260
of the view itself right so for every
 

00:08:33.260 --> 00:08:34.870
of the view itself right so for every
view we're going to say where are you

00:08:34.870 --> 00:08:34.880
view we're going to say where are you
 

00:08:34.880 --> 00:08:36.219
view we're going to say where are you
now we're going to get the top value

00:08:36.219 --> 00:08:36.229
now we're going to get the top value
 

00:08:36.229 --> 00:08:38.710
now we're going to get the top value
child get top we're going to find out

00:08:38.710 --> 00:08:38.720
child get top we're going to find out
 

00:08:38.720 --> 00:08:40.420
child get top we're going to find out
where it is in its container and we're

00:08:40.420 --> 00:08:40.430
where it is in its container and we're
 

00:08:40.430 --> 00:08:42.339
where it is in its container and we're
going to store that information to the

00:08:42.339 --> 00:08:42.349
going to store that information to the
 

00:08:42.349 --> 00:08:45.160
going to store that information to the
with the key of the item ID that's

00:08:45.160 --> 00:08:45.170
with the key of the item ID that's
 

00:08:45.170 --> 00:08:47.290
with the key of the item ID that's
associated with that view before layout

00:08:47.290 --> 00:08:47.300
associated with that view before layout
 

00:08:47.300 --> 00:08:48.850
associated with that view before layout
runs and recycle happens

00:08:48.850 --> 00:08:48.860
runs and recycle happens
 

00:08:48.860 --> 00:08:51.820
runs and recycle happens
and everything gets all confused in the

00:08:51.820 --> 00:08:51.830
and everything gets all confused in the
 

00:08:51.830 --> 00:08:53.650
and everything gets all confused in the
ListView but we don't care because we've

00:08:53.650 --> 00:08:53.660
ListView but we don't care because we've
 

00:08:53.660 --> 00:08:55.450
ListView but we don't care because we've
got the information we need item id

00:08:55.450 --> 00:08:55.460
got the information we need item id
 

00:08:55.460 --> 00:08:57.520
got the information we need item id
associated with position of the view at

00:08:57.520 --> 00:08:57.530
associated with position of the view at
 

00:08:57.530 --> 00:08:59.290
associated with position of the view at
the time then we're actually going to

00:08:59.290 --> 00:08:59.300
the time then we're actually going to
 

00:08:59.300 --> 00:09:02.410
the time then we're actually going to
remove the item and we're going to

00:09:02.410 --> 00:09:02.420
remove the item and we're going to
 

00:09:02.420 --> 00:09:03.730
remove the item and we're going to
remove it from the adapter that

00:09:03.730 --> 00:09:03.740
remove it from the adapter that
 

00:09:03.740 --> 00:09:05.230
remove it from the adapter that
automatically does a notify data set

00:09:05.230 --> 00:09:05.240
automatically does a notify data set
 

00:09:05.240 --> 00:09:08.800
automatically does a notify data set
changed and then we use a trick that's

00:09:08.800 --> 00:09:08.810
changed and then we use a trick that's
 

00:09:08.810 --> 00:09:10.510
changed and then we use a trick that's
common to a lot of my animation demos

00:09:10.510 --> 00:09:10.520
common to a lot of my animation demos
 

00:09:10.520 --> 00:09:12.790
common to a lot of my animation demos
which is we set a non pre-draw listener

00:09:12.790 --> 00:09:12.800
which is we set a non pre-draw listener
 

00:09:12.800 --> 00:09:14.980
which is we set a non pre-draw listener
so what's happened is we've removed the

00:09:14.980 --> 00:09:14.990
so what's happened is we've removed the
 

00:09:14.990 --> 00:09:17.080
so what's happened is we've removed the
item this is going to force a layout to

00:09:17.080 --> 00:09:17.090
item this is going to force a layout to
 

00:09:17.090 --> 00:09:19.090
item this is going to force a layout to
happen on the ListView views are

00:09:19.090 --> 00:09:19.100
happen on the ListView views are
 

00:09:19.100 --> 00:09:20.650
happen on the ListView views are
probably going to be recycled we're

00:09:20.650 --> 00:09:20.660
probably going to be recycled we're
 

00:09:20.660 --> 00:09:21.670
probably going to be recycled we're
going to chuck them out of the ListView

00:09:21.670 --> 00:09:21.680
going to chuck them out of the ListView
 

00:09:21.680 --> 00:09:22.900
going to chuck them out of the ListView
we're going to figure out where items

00:09:22.900 --> 00:09:22.910
we're going to figure out where items
 

00:09:22.910 --> 00:09:23.950
we're going to figure out where items
need to go then we're going to

00:09:23.950 --> 00:09:23.960
need to go then we're going to
 

00:09:23.960 --> 00:09:26.680
need to go then we're going to
repopulate views and who knows what View

00:09:26.680 --> 00:09:26.690
repopulate views and who knows what View
 

00:09:26.690 --> 00:09:28.510
repopulate views and who knows what View
is where we don't care because we have

00:09:28.510 --> 00:09:28.520
is where we don't care because we have
 

00:09:28.520 --> 00:09:30.630
is where we don't care because we have
stable IDs we're good to go

00:09:30.630 --> 00:09:30.640
stable IDs we're good to go
 

00:09:30.640 --> 00:09:33.820
stable IDs we're good to go
layout is going to happen and then our

00:09:33.820 --> 00:09:33.830
layout is going to happen and then our
 

00:09:33.830 --> 00:09:35.440
layout is going to happen and then our
pre-draw listener is going to be called

00:09:35.440 --> 00:09:35.450
pre-draw listener is going to be called
 

00:09:35.450 --> 00:09:36.910
pre-draw listener is going to be called
and this is the important point it's

00:09:36.910 --> 00:09:36.920
and this is the important point it's
 

00:09:36.920 --> 00:09:38.950
and this is the important point it's
going to be called before drawers happen

00:09:38.950 --> 00:09:38.960
going to be called before drawers happen
 

00:09:38.960 --> 00:09:41.680
going to be called before drawers happen
right so layout runs then it calls our

00:09:41.680 --> 00:09:41.690
right so layout runs then it calls our
 

00:09:41.690 --> 00:09:43.420
right so layout runs then it calls our
own pre-draw listener and then we can do

00:09:43.420 --> 00:09:43.430
own pre-draw listener and then we can do
 

00:09:43.430 --> 00:09:45.160
own pre-draw listener and then we can do
whatever we want and what we want to do

00:09:45.160 --> 00:09:45.170
whatever we want and what we want to do
 

00:09:45.170 --> 00:09:48.280
whatever we want and what we want to do
is set up an animation to animate views

00:09:48.280 --> 00:09:48.290
is set up an animation to animate views
 

00:09:48.290 --> 00:09:50.500
is set up an animation to animate views
from where they were in the previous

00:09:50.500 --> 00:09:50.510
from where they were in the previous
 

00:09:50.510 --> 00:09:54.010
from where they were in the previous
view in the previous frame into where we

00:09:54.010 --> 00:09:54.020
view in the previous frame into where we
 

00:09:54.020 --> 00:09:55.900
view in the previous frame into where we
want them to be now that layout has run

00:09:55.900 --> 00:09:55.910
want them to be now that layout has run
 

00:09:55.910 --> 00:09:57.340
want them to be now that layout has run
in the ListView is finalized all the

00:09:57.340 --> 00:09:57.350
in the ListView is finalized all the
 

00:09:57.350 --> 00:09:59.680
in the ListView is finalized all the
content for these views that change so

00:09:59.680 --> 00:09:59.690
content for these views that change so
 

00:09:59.690 --> 00:10:01.450
content for these views that change so
the on pre draw callback gets called

00:10:01.450 --> 00:10:01.460
the on pre draw callback gets called
 

00:10:01.460 --> 00:10:03.190
the on pre draw callback gets called
here where you remove the listener

00:10:03.190 --> 00:10:03.200
here where you remove the listener
 

00:10:03.200 --> 00:10:04.600
here where you remove the listener
because we don't care about it after

00:10:04.600 --> 00:10:04.610
because we don't care about it after
 

00:10:04.610 --> 00:10:07.260
because we don't care about it after
this one frame then we come in here and

00:10:07.260 --> 00:10:07.270
this one frame then we come in here and
 

00:10:07.270 --> 00:10:10.780
this one frame then we come in here and
walk through all current children of the

00:10:10.780 --> 00:10:10.790
walk through all current children of the
 

00:10:10.790 --> 00:10:12.550
walk through all current children of the
ListView right so this is everything

00:10:12.550 --> 00:10:12.560
ListView right so this is everything
 

00:10:12.560 --> 00:10:15.130
ListView right so this is everything
after layout ran everything got recycled

00:10:15.130 --> 00:10:15.140
after layout ran everything got recycled
 

00:10:15.140 --> 00:10:17.170
after layout ran everything got recycled
shuffled around for every one of those

00:10:17.170 --> 00:10:17.180
shuffled around for every one of those
 

00:10:17.180 --> 00:10:18.640
shuffled around for every one of those
we're going to say okay where are you

00:10:18.640 --> 00:10:18.650
we're going to say okay where are you
 

00:10:18.650 --> 00:10:21.370
we're going to say okay where are you
now give me your current top position

00:10:21.370 --> 00:10:21.380
now give me your current top position
 

00:10:21.380 --> 00:10:26.590
now give me your current top position
and if the position of that same ID so

00:10:26.590 --> 00:10:26.600
and if the position of that same ID so
 

00:10:26.600 --> 00:10:28.930
and if the position of that same ID so
I'm also tracking the the current ID of

00:10:28.930 --> 00:10:28.940
I'm also tracking the the current ID of
 

00:10:28.940 --> 00:10:32.020
I'm also tracking the the current ID of
this view and I know what the ID used to

00:10:32.020 --> 00:10:32.030
this view and I know what the ID used to
 

00:10:32.030 --> 00:10:33.940
this view and I know what the ID used to
be for that content before layout ran

00:10:33.940 --> 00:10:33.950
be for that content before layout ran
 

00:10:33.950 --> 00:10:37.210
be for that content before layout ran
and if we have a non null value for

00:10:37.210 --> 00:10:37.220
and if we have a non null value for
 

00:10:37.220 --> 00:10:39.340
and if we have a non null value for
start top that means that this view used

00:10:39.340 --> 00:10:39.350
start top that means that this view used
 

00:10:39.350 --> 00:10:41.290
start top that means that this view used
to be somewhere else in the container

00:10:41.290 --> 00:10:41.300
to be somewhere else in the container
 

00:10:41.300 --> 00:10:43.690
to be somewhere else in the container
and we're going to run an animation to

00:10:43.690 --> 00:10:43.700
and we're going to run an animation to
 

00:10:43.700 --> 00:10:47.980
and we're going to run an animation to
animate that change in values so if the

00:10:47.980 --> 00:10:47.990
animate that change in values so if the
 

00:10:47.990 --> 00:10:50.830
animate that change in values so if the
start if the the top position before

00:10:50.830 --> 00:10:50.840
start if the the top position before
 

00:10:50.840 --> 00:10:53.650
start if the the top position before
layout for this content is different

00:10:53.650 --> 00:10:53.660
layout for this content is different
 

00:10:53.660 --> 00:10:56.830
layout for this content is different
than the top position for for that item

00:10:56.830 --> 00:10:56.840
than the top position for for that item
 

00:10:56.840 --> 00:10:59.530
than the top position for for that item
after layout then we want to run the

00:10:59.530 --> 00:10:59.540
after layout then we want to run the
 

00:10:59.540 --> 00:11:01.330
after layout then we want to run the
animation so we're going to set an

00:11:01.330 --> 00:11:01.340
animation so we're going to set an
 

00:11:01.340 --> 00:11:01.890
animation so we're going to set an
initial

00:11:01.890 --> 00:11:01.900
initial
 

00:11:01.900 --> 00:11:04.170
initial
insulation y-value to basically run it

00:11:04.170 --> 00:11:04.180
insulation y-value to basically run it
 

00:11:04.180 --> 00:11:06.210
insulation y-value to basically run it
back to wherever it started from and

00:11:06.210 --> 00:11:06.220
back to wherever it started from and
 

00:11:06.220 --> 00:11:08.190
back to wherever it started from and
then we're going to animate to

00:11:08.190 --> 00:11:08.200
then we're going to animate to
 

00:11:08.200 --> 00:11:09.840
then we're going to animate to
translation Y of zero so we're basically

00:11:09.840 --> 00:11:09.850
translation Y of zero so we're basically
 

00:11:09.850 --> 00:11:13.200
translation Y of zero so we're basically
just going to animate it into place if

00:11:13.200 --> 00:11:13.210
just going to animate it into place if
 

00:11:13.210 --> 00:11:14.730
just going to animate it into place if
this is the first time it's running then

00:11:14.730 --> 00:11:14.740
this is the first time it's running then
 

00:11:14.740 --> 00:11:17.370
this is the first time it's running then
we want to with the first animation go

00:11:17.370 --> 00:11:17.380
we want to with the first animation go
 

00:11:17.380 --> 00:11:19.050
we want to with the first animation go
ahead and restore some values when we're

00:11:19.050 --> 00:11:19.060
ahead and restore some values when we're
 

00:11:19.060 --> 00:11:21.590
ahead and restore some values when we're
done kind of tedious to each other if

00:11:21.590 --> 00:11:21.600
done kind of tedious to each other if
 

00:11:21.600 --> 00:11:24.930
done kind of tedious to each other if
there is no starting position for that

00:11:24.930 --> 00:11:24.940
there is no starting position for that
 

00:11:24.940 --> 00:11:26.760
there is no starting position for that
particular content item then that means

00:11:26.760 --> 00:11:26.770
particular content item then that means
 

00:11:26.770 --> 00:11:28.950
particular content item then that means
that this view is just moving on to the

00:11:28.950 --> 00:11:28.960
that this view is just moving on to the
 

00:11:28.960 --> 00:11:30.420
that this view is just moving on to the
screen either from the bottom or the top

00:11:30.420 --> 00:11:30.430
screen either from the bottom or the top
 

00:11:30.430 --> 00:11:32.970
screen either from the bottom or the top
so we calculate an initial position to

00:11:32.970 --> 00:11:32.980
so we calculate an initial position to
 

00:11:32.980 --> 00:11:38.160
so we calculate an initial position to
start from and there's a little bit of

00:11:38.160 --> 00:11:38.170
start from and there's a little bit of
 

00:11:38.170 --> 00:11:39.450
start from and there's a little bit of
repeated code there don't worry about

00:11:39.450 --> 00:11:39.460
repeated code there don't worry about
 

00:11:39.460 --> 00:11:44.760
repeated code there don't worry about
that and then we come in here and we

00:11:44.760 --> 00:11:44.770
that and then we come in here and we
 

00:11:44.770 --> 00:11:46.890
that and then we come in here and we
again set the initial translation Y

00:11:46.890 --> 00:11:46.900
again set the initial translation Y
 

00:11:46.900 --> 00:11:49.470
again set the initial translation Y
value to that Delta and we animated the

00:11:49.470 --> 00:11:49.480
value to that Delta and we animated the
 

00:11:49.480 --> 00:11:51.150
value to that Delta and we animated the
animation code is exactly what we saw

00:11:51.150 --> 00:11:51.160
animation code is exactly what we saw
 

00:11:51.160 --> 00:11:52.560
animation code is exactly what we saw
before the only difference is

00:11:52.560 --> 00:11:52.570
before the only difference is
 

00:11:52.570 --> 00:11:54.360
before the only difference is
calculating the initial position for an

00:11:54.360 --> 00:11:54.370
calculating the initial position for an
 

00:11:54.370 --> 00:11:56.520
calculating the initial position for an
item that was previously off the screen

00:11:56.520 --> 00:11:56.530
item that was previously off the screen
 

00:11:56.530 --> 00:11:58.200
item that was previously off the screen
didn't exist in the ListView container

00:11:58.200 --> 00:11:58.210
didn't exist in the ListView container
 

00:11:58.210 --> 00:12:00.810
didn't exist in the ListView container
before and then when we're all done we

00:12:00.810 --> 00:12:00.820
before and then when we're all done we
 

00:12:00.820 --> 00:12:02.730
before and then when we're all done we
clear the top map which is where we were

00:12:02.730 --> 00:12:02.740
clear the top map which is where we were
 

00:12:02.740 --> 00:12:04.290
clear the top map which is where we were
storing these values of item IDs

00:12:04.290 --> 00:12:04.300
storing these values of item IDs
 

00:12:04.300 --> 00:12:09.210
storing these values of item IDs
associated with the top positions the

00:12:09.210 --> 00:12:09.220
associated with the top positions the
 

00:12:09.220 --> 00:12:11.160
associated with the top positions the
only other that's all the animation code

00:12:11.160 --> 00:12:11.170
only other that's all the animation code
 

00:12:11.170 --> 00:12:12.480
only other that's all the animation code
here the only other thing that's

00:12:12.480 --> 00:12:12.490
here the only other thing that's
 

00:12:12.490 --> 00:12:14.610
here the only other thing that's
interesting here is the background

00:12:14.610 --> 00:12:14.620
interesting here is the background
 

00:12:14.620 --> 00:12:16.920
interesting here is the background
container so there's kind of a graphics

00:12:16.920 --> 00:12:16.930
container so there's kind of a graphics
 

00:12:16.930 --> 00:12:19.200
container so there's kind of a graphics
optimization here where if we are

00:12:19.200 --> 00:12:19.210
optimization here where if we are
 

00:12:19.210 --> 00:12:21.000
optimization here where if we are
constantly drawing a background behind a

00:12:21.000 --> 00:12:21.010
constantly drawing a background behind a
 

00:12:21.010 --> 00:12:22.950
constantly drawing a background behind a
ListView where all of the items are

00:12:22.950 --> 00:12:22.960
ListView where all of the items are
 

00:12:22.960 --> 00:12:25.290
ListView where all of the items are
opaque then that means we're basically

00:12:25.290 --> 00:12:25.300
opaque then that means we're basically
 

00:12:25.300 --> 00:12:26.850
opaque then that means we're basically
getting overdraw we're drawing an entire

00:12:26.850 --> 00:12:26.860
getting overdraw we're drawing an entire
 

00:12:26.860 --> 00:12:28.470
getting overdraw we're drawing an entire
background and then we're drawing all

00:12:28.470 --> 00:12:28.480
background and then we're drawing all
 

00:12:28.480 --> 00:12:30.030
background and then we're drawing all
the items on top of that background

00:12:30.030 --> 00:12:30.040
the items on top of that background
 

00:12:30.040 --> 00:12:32.040
the items on top of that background
which is kind of a wasted effort if you

00:12:32.040 --> 00:12:32.050
which is kind of a wasted effort if you
 

00:12:32.050 --> 00:12:34.170
which is kind of a wasted effort if you
really care about animation if you

00:12:34.170 --> 00:12:34.180
really care about animation if you
 

00:12:34.180 --> 00:12:35.460
really care about animation if you
really care about performance and you

00:12:35.460 --> 00:12:35.470
really care about performance and you
 

00:12:35.470 --> 00:12:36.990
really care about performance and you
notice that you're getting bottlenecked

00:12:36.990 --> 00:12:37.000
notice that you're getting bottlenecked
 

00:12:37.000 --> 00:12:39.090
notice that you're getting bottlenecked
in some situations then one way that you

00:12:39.090 --> 00:12:39.100
in some situations then one way that you
 

00:12:39.100 --> 00:12:41.610
in some situations then one way that you
can work around this is to set a null

00:12:41.610 --> 00:12:41.620
can work around this is to set a null
 

00:12:41.620 --> 00:12:43.140
can work around this is to set a null
background on that container so that

00:12:43.140 --> 00:12:43.150
background on that container so that
 

00:12:43.150 --> 00:12:44.400
background on that container so that
we're not going to draw anything behind

00:12:44.400 --> 00:12:44.410
we're not going to draw anything behind
 

00:12:44.410 --> 00:12:46.560
we're not going to draw anything behind
it well that's a problem if you're

00:12:46.560 --> 00:12:46.570
it well that's a problem if you're
 

00:12:46.570 --> 00:12:48.390
it well that's a problem if you're
swiping out and you see into the

00:12:48.390 --> 00:12:48.400
swiping out and you see into the
 

00:12:48.400 --> 00:12:50.070
swiping out and you see into the
nothingness that's behind the ListView

00:12:50.070 --> 00:12:50.080
nothingness that's behind the ListView
 

00:12:50.080 --> 00:12:53.010
nothingness that's behind the ListView
so what we do is when we start doing the

00:12:53.010 --> 00:12:53.020
so what we do is when we start doing the
 

00:12:53.020 --> 00:12:54.810
so what we do is when we start doing the
swipe we tell the background container

00:12:54.810 --> 00:12:54.820
swipe we tell the background container
 

00:12:54.820 --> 00:12:57.330
swipe we tell the background container
to show the background that sets up some

00:12:57.330 --> 00:12:57.340
to show the background that sets up some
 

00:12:57.340 --> 00:12:59.220
to show the background that sets up some
initial values here so that we know

00:12:59.220 --> 00:12:59.230
initial values here so that we know
 

00:12:59.230 --> 00:13:01.260
initial values here so that we know
where to draw this this item background

00:13:01.260 --> 00:13:01.270
where to draw this this item background
 

00:13:01.270 --> 00:13:04.530
where to draw this this item background
and then we override on draw and say

00:13:04.530 --> 00:13:04.540
and then we override on draw and say
 

00:13:04.540 --> 00:13:07.140
and then we override on draw and say
okay well if if we're drawing this thing

00:13:07.140 --> 00:13:07.150
okay well if if we're drawing this thing
 

00:13:07.150 --> 00:13:09.390
okay well if if we're drawing this thing
then we'll go ahead and translate to the

00:13:09.390 --> 00:13:09.400
then we'll go ahead and translate to the
 

00:13:09.400 --> 00:13:11.520
then we'll go ahead and translate to the
open area and we'll draw our shadowed

00:13:11.520 --> 00:13:11.530
open area and we'll draw our shadowed
 

00:13:11.530 --> 00:13:13.230
open area and we'll draw our shadowed
background and our shadow background is

00:13:13.230 --> 00:13:13.240
background and our shadow background is
 

00:13:13.240 --> 00:13:14.610
background and our shadow background is
seen here this

00:13:14.610 --> 00:13:14.620
seen here this
 

00:13:14.620 --> 00:13:15.870
seen here this
is called from the constructors and we

00:13:15.870 --> 00:13:15.880
is called from the constructors and we
 

00:13:15.880 --> 00:13:18.480
is called from the constructors and we
simply load in this this resource this

00:13:18.480 --> 00:13:18.490
simply load in this this resource this
 

00:13:18.490 --> 00:13:21.150
simply load in this this resource this
is a nine patch the I defined it's very

00:13:21.150 --> 00:13:21.160
is a nine patch the I defined it's very
 

00:13:21.160 --> 00:13:23.040
is a nine patch the I defined it's very
simple it's basically shadow on top

00:13:23.040 --> 00:13:23.050
simple it's basically shadow on top
 

00:13:23.050 --> 00:13:26.220
simple it's basically shadow on top
shadow on bottom and then an area in the

00:13:26.220 --> 00:13:26.230
shadow on bottom and then an area in the
 

00:13:26.230 --> 00:13:28.200
shadow on bottom and then an area in the
middle it gets stretched and the net

00:13:28.200 --> 00:13:28.210
middle it gets stretched and the net
 

00:13:28.210 --> 00:13:31.080
middle it gets stretched and the net
effect which you can see in the demo is

00:13:31.080 --> 00:13:31.090
effect which you can see in the demo is
 

00:13:31.090 --> 00:13:32.310
effect which you can see in the demo is
that we have a little bit of shadow and

00:13:32.310 --> 00:13:32.320
that we have a little bit of shadow and
 

00:13:32.320 --> 00:13:34.320
that we have a little bit of shadow and
a little bit of shadow on top and a

00:13:34.320 --> 00:13:34.330
a little bit of shadow on top and a
 

00:13:34.330 --> 00:13:36.030
a little bit of shadow on top and a
little bit of shadow on bottom and then

00:13:36.030 --> 00:13:36.040
little bit of shadow on bottom and then
 

00:13:36.040 --> 00:13:38.040
little bit of shadow on bottom and then
this gray area in the middle so it makes

00:13:38.040 --> 00:13:38.050
this gray area in the middle so it makes
 

00:13:38.050 --> 00:13:40.170
this gray area in the middle so it makes
it look like all the items in the list

00:13:40.170 --> 00:13:40.180
it look like all the items in the list
 

00:13:40.180 --> 00:13:41.550
it look like all the items in the list
view are sort of popped out from this

00:13:41.550 --> 00:13:41.560
view are sort of popped out from this
 

00:13:41.560 --> 00:13:43.830
view are sort of popped out from this
virtual background that we have there

00:13:43.830 --> 00:13:43.840
virtual background that we have there
 

00:13:43.840 --> 00:13:46.500
virtual background that we have there
another item to mention is sometimes

00:13:46.500 --> 00:13:46.510
another item to mention is sometimes
 

00:13:46.510 --> 00:13:48.330
another item to mention is sometimes
when you're animating listviews if you

00:13:48.330 --> 00:13:48.340
when you're animating listviews if you
 

00:13:48.340 --> 00:13:50.310
when you're animating listviews if you
have dividers in the ListView and you're

00:13:50.310 --> 00:13:50.320
have dividers in the ListView and you're
 

00:13:50.320 --> 00:13:52.590
have dividers in the ListView and you're
sort of playing with things like we are

00:13:52.590 --> 00:13:52.600
sort of playing with things like we are
 

00:13:52.600 --> 00:13:54.570
sort of playing with things like we are
here like animating the translation

00:13:54.570 --> 00:13:54.580
here like animating the translation
 

00:13:54.580 --> 00:13:56.250
here like animating the translation
properties you may know that the notice

00:13:56.250 --> 00:13:56.260
properties you may know that the notice
 

00:13:56.260 --> 00:13:57.510
properties you may know that the notice
the dividers aren't necessarily getting

00:13:57.510 --> 00:13:57.520
the dividers aren't necessarily getting
 

00:13:57.520 --> 00:14:00.210
the dividers aren't necessarily getting
drawn correctly so I disabled dividers

00:14:00.210 --> 00:14:00.220
drawn correctly so I disabled dividers
 

00:14:00.220 --> 00:14:06.320
drawn correctly so I disabled dividers
so if you take a look at the layout for

00:14:06.320 --> 00:14:06.330
 

00:14:06.330 --> 00:14:09.450
application we have ListView divider of

00:14:09.450 --> 00:14:09.460
application we have ListView divider of
 

00:14:09.460 --> 00:14:12.000
application we have ListView divider of
null and a divider height of zero so the

00:14:12.000 --> 00:14:12.010
null and a divider height of zero so the
 

00:14:12.010 --> 00:14:14.160
null and a divider height of zero so the
ListView itself is not drawing dividers

00:14:14.160 --> 00:14:14.170
ListView itself is not drawing dividers
 

00:14:14.170 --> 00:14:17.630
ListView itself is not drawing dividers
and instead I've defined the textview to

00:14:17.630 --> 00:14:17.640
and instead I've defined the textview to
 

00:14:17.640 --> 00:14:22.400
and instead I've defined the textview to
actually use a divider so it's using a

00:14:22.400 --> 00:14:22.410
actually use a divider so it's using a
 

00:14:22.410 --> 00:14:25.050
actually use a divider so it's using a
backgrounds which I defined which is

00:14:25.050 --> 00:14:25.060
backgrounds which I defined which is
 

00:14:25.060 --> 00:14:28.080
backgrounds which I defined which is
basically all up a quite with a an

00:14:28.080 --> 00:14:28.090
basically all up a quite with a an
 

00:14:28.090 --> 00:14:31.110
basically all up a quite with a an
opaque line at the bottom of it and that

00:14:31.110 --> 00:14:31.120
opaque line at the bottom of it and that
 

00:14:31.120 --> 00:14:33.060
opaque line at the bottom of it and that
gives me my own divider that gets

00:14:33.060 --> 00:14:33.070
gives me my own divider that gets
 

00:14:33.070 --> 00:14:34.530
gives me my own divider that gets
animated along with these items as

00:14:34.530 --> 00:14:34.540
animated along with these items as
 

00:14:34.540 --> 00:14:36.420
animated along with these items as
they're moving around the ListView so

00:14:36.420 --> 00:14:36.430
they're moving around the ListView so
 

00:14:36.430 --> 00:14:38.430
they're moving around the ListView so
again this is ListView removal

00:14:38.430 --> 00:14:38.440
again this is ListView removal
 

00:14:38.440 --> 00:14:40.440
again this is ListView removal
animations it's the ability to animate

00:14:40.440 --> 00:14:40.450
animations it's the ability to animate
 

00:14:40.450 --> 00:14:42.060
animations it's the ability to animate
all the changes you could do a very

00:14:42.060 --> 00:14:42.070
all the changes you could do a very
 

00:14:42.070 --> 00:14:43.920
all the changes you could do a very
similar thing with adding I just only

00:14:43.920 --> 00:14:43.930
similar thing with adding I just only
 

00:14:43.930 --> 00:14:46.500
similar thing with adding I just only
took care of the one direction today but

00:14:46.500 --> 00:14:46.510
took care of the one direction today but
 

00:14:46.510 --> 00:14:49.230
took care of the one direction today but
it's doing it in a way that is usable on

00:14:49.230 --> 00:14:49.240
it's doing it in a way that is usable on
 

00:14:49.240 --> 00:14:52.680
it's doing it in a way that is usable on
all property animation api's all the way

00:14:52.680 --> 00:14:52.690
all property animation api's all the way
 

00:14:52.690 --> 00:14:54.930
all property animation api's all the way
back to when view property animator came

00:14:54.930 --> 00:14:54.940
back to when view property animator came
 

00:14:54.940 --> 00:14:57.090
back to when view property animator came
in which is 3.1 in fact you could use

00:14:57.090 --> 00:14:57.100
in which is 3.1 in fact you could use
 

00:14:57.100 --> 00:14:58.620
in which is 3.1 in fact you could use
object animator for everything and take

00:14:58.620 --> 00:14:58.630
object animator for everything and take
 

00:14:58.630 --> 00:15:02.460
object animator for everything and take
it all the way back to 3.0 and if you

00:15:02.460 --> 00:15:02.470
it all the way back to 3.0 and if you
 

00:15:02.470 --> 00:15:04.980
it all the way back to 3.0 and if you
want a little teaser in a future demo

00:15:04.980 --> 00:15:04.990
want a little teaser in a future demo
 

00:15:04.990 --> 00:15:06.960
want a little teaser in a future demo
we'll see how we can use a very similar

00:15:06.960 --> 00:15:06.970
we'll see how we can use a very similar
 

00:15:06.970 --> 00:15:08.730
we'll see how we can use a very similar
technique and actually run this thing on

00:15:08.730 --> 00:15:08.740
technique and actually run this thing on
 

00:15:08.740 --> 00:15:10.860
technique and actually run this thing on
gingerbread as well so check out the

00:15:10.860 --> 00:15:10.870
gingerbread as well so check out the
 

00:15:10.870 --> 00:15:12.630
gingerbread as well so check out the
talk at Google IO that we did on

00:15:12.630 --> 00:15:12.640
talk at Google IO that we did on
 

00:15:12.640 --> 00:15:15.150
talk at Google IO that we did on
animation called a moving experience and

00:15:15.150 --> 00:15:15.160
animation called a moving experience and
 

00:15:15.160 --> 00:15:17.460
animation called a moving experience and
download the code and play with it and

00:15:17.460 --> 00:15:17.470
download the code and play with it and
 

00:15:17.470 --> 00:15:21.810
download the code and play with it and
make your list views more dynamic thanks

